# 更新说明 - 2024年12月

## 已解决的问题

### 1. 卡片编辑创建新记录问题（已修复）

**问题描述**：用户编辑卡片人信息后，系统会创建一个新的卡片人而不是更新原有记录。

**解决方案**：
1. 在 `PersonEditModal.tsx` 中明确保留原有ID
2. 在 `cloudStore.ts` 的 `upsertPersonToCloud` 函数中指定冲突处理策略
3. 在 `person/[id]/page.tsx` 中添加了数据刷新逻辑，确保编辑后从云端重新加载数据

**技术细节**：
- 使用 Supabase 的 `upsert` 方法时，明确指定 `onConflict: 'id'` 参数
- 添加了日志输出以便调试
- 编辑保存后延迟1秒重新从云端加载数据，确保显示最新信息

### 2. 删除"或上传Excel文件："文本（已完成）

**修改内容**：从信息录入页面（`app/add/page.tsx`）中删除了所有"或上传Excel文件："的提示文本。

## 数据库配置

### Supabase 表结构要求

如果您是第一次设置 Supabase，请确保数据库表结构正确：

1. **运行 SQL 脚本**：
   - 在 Supabase Dashboard 中打开 SQL Editor
   - 执行 `supabase-setup.sql` 文件中的语句
   - 这将创建正确的表结构和索引

2. **重要提示**：
   - `people` 表的 `id` 字段必须是 TEXT 类型（不是 UUID）
   - 这是因为系统使用时间戳字符串作为ID

## 测试建议

1. **测试编辑功能**：
   - 进入任意人物详情页
   - 点击编辑按钮
   - 修改信息并保存
   - 确认没有创建新记录，而是更新了原有记录

2. **使用诊断工具**：
   - 在浏览器中打开 `test-supabase.html`
   - 点击"测试编辑功能"按钮
   - 查看是否正确更新而非创建新记录

## 注意事项

- 如果仍然出现创建新记录的问题，请检查浏览器控制台的日志输出
- 确保 Supabase 的 `people` 表已正确设置主键为 `id` 字段
- 清除浏览器缓存后重试
